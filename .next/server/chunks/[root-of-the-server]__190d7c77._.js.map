{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 182, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/backend/db.js"],"sourcesContent":["import mysql from 'mysql2/promise';\nimport dotenv from 'dotenv';\nimport path from 'path';\nimport fs from 'fs';\nimport { fileURLToPath } from 'url';\n\n// Get the directory name in ES module scope\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\n// Construct absolute path to .env file in the parent directory\nconst envPath = path.resolve(__dirname, \".env\");\ndotenv.config({ path: envPath });\n\n// Construct absolute path to ca.pem file in the same directory\nconst caPath = path.resolve(__dirname, \"ca.pem\");\nlet caCert;\n\ntry {\n  if (!fs.existsSync(caPath)) {\n    console.error(`CRITICAL_DB_INIT_ERROR: CA certificate file (ca.pem) not found at expected location: ${caPath}. Database connections requiring SSL will likely fail. Please ensure 'backend/ca.pem' exists.`);\n    // caCert will remain undefined. mysql.createPool might fail if SSL is strictly required.\n  } else {\n    caCert = fs.readFileSync(caPath, 'utf8');\n  }\n} catch (e) {\n  console.error(`CRITICAL_DB_INIT_ERROR: Error reading CA certificate file (ca.pem) at ${caPath}: ${e.message}. Database connections may fail.`);\n  // Depending on the error, caCert might be undefined or an error could be thrown, halting further execution.\n  // For robustness, we could choose to throw here to make the failure explicit.\n  // throw new Error(`Failed to read ca.pem: ${e.message}`);\n}\n\n// Check for essential DB environment variables\nconst essentialEnvVars = ['DB_HOST', 'DB_USER', 'DB_PASSWORD', 'DB_NAME'];\nconst missingEnvVars = essentialEnvVars.filter(v => !process.env[v]);\n\nif (missingEnvVars.length > 0) {\n    console.error(`CRITICAL_DB_INIT_ERROR: Missing essential database environment variables: ${missingEnvVars.join(', ')}. These should be defined in backend/.env for local development or configured in your hosting environment. Database connections will fail.`);\n    // To make the server fail fast and clearly, throwing an error here is a good practice.\n    // This prevents a more obscure \"Internal Server Error\" later.\n    // throw new Error(`Missing critical DB environment variables: ${missingEnvVars.join(', ')}. Check your backend/.env file or hosting configuration.`);\n}\n\nlet pool;\ntry {\n  pool = mysql.createPool({\n    host: process.env.DB_HOST,\n    user: process.env.DB_USER,\n    password: process.env.DB_PASSWORD,\n    database: process.env.DB_NAME,\n    port: process.env.DB_PORT ? parseInt(process.env.DB_PORT, 10) : 3306,\n    ssl: {\n      ca: caCert, // If caCert is undefined due to file not found, this may cause issues\n      rejectUnauthorized: true, // Recommended for production if using a trusted CA\n    },\n    waitForConnections: true,\n    connectionLimit: 10,\n    queueLimit: 0,\n  });\n  console.log(\"DB_INIT_SUCCESS: MySQL connection pool created (this does not guarantee successful connection yet, but configuration is loaded).\");\n} catch (error) {\n  console.error(`CRITICAL_DB_INIT_ERROR: Failed to create MySQL connection pool: ${error.message}. This is a fatal error for database operations.`);\n  // Re-throwing the error here will make the application fail on startup if the pool cannot be initialized,\n  // which is often better than encountering errors later during request handling.\n  throw new Error(`Failed to initialize database connection pool due to: ${error.message}. Review DB configuration (backend/.env) and SSL certificate (backend/ca.pem).`);\n}\n\n// Export the connection pool\nexport {pool};"],"names":[],"mappings":";;;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;AAEA,4CAA4C;AAC5C,MAAM,aAAa,CAAA,GAAA,+FAAA,CAAA,gBAAa,AAAD,EAAE,8BAAY,GAAG;AAChD,MAAM,YAAY,iGAAA,CAAA,UAAI,CAAC,OAAO,CAAC;AAE/B,+DAA+D;AAC/D,MAAM,UAAU,iGAAA,CAAA,UAAI,CAAC,OAAO,CAAC,WAAW;AACxC,uIAAA,CAAA,UAAM,CAAC,MAAM,CAAC;IAAE,MAAM;AAAQ;AAE9B,+DAA+D;AAC/D,MAAM,SAAS,iGAAA,CAAA,UAAI,CAAC,OAAO,CAAC,WAAW;AACvC,IAAI;AAEJ,IAAI;IACF,IAAI,CAAC,6FAAA,CAAA,UAAE,CAAC,UAAU,CAAC,SAAS;QAC1B,QAAQ,KAAK,CAAC,CAAC,qFAAqF,EAAE,OAAO,6FAA6F,CAAC;IAC3M,yFAAyF;IAC3F,OAAO;QACL,SAAS,6FAAA,CAAA,UAAE,CAAC,YAAY,CAAC,QAAQ;IACnC;AACF,EAAE,OAAO,GAAG;IACV,QAAQ,KAAK,CAAC,CAAC,sEAAsE,EAAE,OAAO,EAAE,EAAE,EAAE,OAAO,CAAC,gCAAgC,CAAC;AAC7I,4GAA4G;AAC5G,8EAA8E;AAC9E,0DAA0D;AAC5D;AAEA,+CAA+C;AAC/C,MAAM,mBAAmB;IAAC;IAAW;IAAW;IAAe;CAAU;AACzE,MAAM,iBAAiB,iBAAiB,MAAM,CAAC,CAAA,IAAK,CAAC,QAAQ,GAAG,CAAC,EAAE;AAEnE,IAAI,eAAe,MAAM,GAAG,GAAG;IAC3B,QAAQ,KAAK,CAAC,CAAC,0EAA0E,EAAE,eAAe,IAAI,CAAC,MAAM,0IAA0I,CAAC;AAChQ,uFAAuF;AACvF,8DAA8D;AAC9D,sJAAsJ;AAC1J;AAEA,IAAI;AACJ,IAAI;IACF,OAAO,mIAAA,CAAA,UAAK,CAAC,UAAU,CAAC;QACtB,MAAM,QAAQ,GAAG,CAAC,OAAO;QACzB,MAAM,QAAQ,GAAG,CAAC,OAAO;QACzB,UAAU,QAAQ,GAAG,CAAC,WAAW;QACjC,UAAU,QAAQ,GAAG,CAAC,OAAO;QAC7B,MAAM,QAAQ,GAAG,CAAC,OAAO,GAAG,SAAS,QAAQ,GAAG,CAAC,OAAO,EAAE,MAAM;QAChE,KAAK;YACH,IAAI;YACJ,oBAAoB;QACtB;QACA,oBAAoB;QACpB,iBAAiB;QACjB,YAAY;IACd;IACA,QAAQ,GAAG,CAAC;AACd,EAAE,OAAO,OAAO;IACd,QAAQ,KAAK,CAAC,CAAC,gEAAgE,EAAE,MAAM,OAAO,CAAC,gDAAgD,CAAC;IAChJ,0GAA0G;IAC1G,gFAAgF;IAChF,MAAM,IAAI,MAAM,CAAC,sDAAsD,EAAE,MAAM,OAAO,CAAC,8EAA8E,CAAC;AACxK","debugId":null}},
    {"offset": {"line": 268, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/api/quotes/route.ts"],"sourcesContent":["\nimport { NextResponse } from 'next/server';\nimport { pool } from '../../../../backend/db.js';\nimport type { QuotePayload, QuoteItem, Client, Approver } from '@/types';\nimport csv from 'csv-parser';\nimport { Readable } from 'stream';\nimport { randomUUID } from 'crypto';\n\nexport async function POST(request: Request) {\n  const contentType = request.headers.get('content-type');\n  let connection;\n  console.log(`[API_INFO] /api/quotes POST: Received request with Content-Type: ${contentType}`);\n\n  if (contentType && contentType.includes('multipart/form-data')) {\n    console.log('[API_INFO] /api/quotes POST: Processing multipart/form-data for CSV upload.');\n    try {\n      const formData = await request.formData();\n      const file = formData.get('file') as File | null;\n\n      if (!file) {\n        console.error('[API_ERROR] /api/quotes POST CSV: No file found in formData.');\n        return NextResponse.json({ error: 'No file uploaded for quotes' }, { status: 400 });\n      }\n      console.log(`[API_INFO] /api/quotes POST CSV: Received file: ${file.name}, size: ${file.size}, type: ${file.type}`);\n      \n      const fileBuffer = Buffer.from(await file.arrayBuffer());\n      const results: any[] = [];\n      const stream = Readable.from(fileBuffer);\n      let firstRecordLogged = false;\n\n      console.log('[API_INFO] /api/quotes POST CSV: Starting CSV parsing...');\n      await new Promise<void>((resolve, reject) => {\n        stream\n          .pipe(csv({ mapHeaders: ({ header }) => header.trim() }))\n          .on('headers', (headers) => console.log('[API_INFO] /api/quotes POST CSV: Detected CSV Headers:', headers))\n          .on('data', (data) => {\n             if (!firstRecordLogged) {\n              console.log('[API_DEBUG] /api/quotes POST CSV: First parsed data record from CSV:', data);\n              firstRecordLogged = true;\n            }\n            results.push(data);\n          })\n          .on('end', () => {\n            console.log(`[API_INFO] /api/quotes POST CSV: CSV parsing finished. ${results.length} records found.`);\n            resolve();\n          })\n          .on('error', (parseError) => {\n            console.error('[API_ERROR] /api/quotes POST CSV: Error during CSV parsing:', parseError);\n            reject(parseError);\n          });\n      });\n\n      if (results.length === 0) {\n        console.warn('[API_WARN] /api/quotes POST CSV: CSV file is empty or yielded no records.');\n        return NextResponse.json({ message: 'CSV file is empty or yielded no records for quotes.' }, { status: 400 });\n      }\n\n      console.log('[API_INFO] /api/quotes POST CSV: Attempting to get database connection for batch insert/update.');\n      connection = await pool.getConnection();\n      console.log('[API_INFO] /api/quotes POST CSV: Database connection obtained.');\n      await connection.beginTransaction();\n      console.log('[API_INFO] /api/quotes POST CSV: Database transaction started.');\n\n      let successfulImports = 0;\n      const importErrors: string[] = [];\n\n      for (const [index, record] of results.entries()) {\n        const quoteId = record['ID'] || record['id'] || randomUUID();\n        const quoteData: Partial<QuotePayload> = {\n          id: quoteId,\n          quoteNumber: record['QuoteNumber'] || `CSV-Q-${quoteId.slice(0,8)}`,\n          quoteDate: record['QuoteDate'] ? new Date(record['QuoteDate']).toISOString() : new Date().toISOString(),\n          clientId: record['ClientID'] || record['ClientId'] || record['clientId'],\n          creatorEmail: record['CreatorEmail'] || 'csv_import@system.com',\n          subTotal: parseFloat(record['SubTotal'] || 0),\n          vatAmount: parseFloat(record['VATAmount'] || 0),\n          grandTotal: parseFloat(record['GrandTotal'] || 0),\n          currency: record['Currency'] || 'MZN',\n          termsAndConditions: record['TermsAndConditions'],\n          notes: record['Notes'],\n          status: (record['Status'] || 'Draft') as QuotePayload['status'],\n          approverId: record['ApproverID'] || record['ApproverId'] || record['approverId'] || null,\n          approvalDate: record['ApprovalDate'] ? new Date(record['ApprovalDate']).toISOString() : null,\n        };\n        \n        console.log(`[API_DEBUG] /api/quotes POST CSV: Processing record #${index + 1}: ${JSON.stringify(quoteData).substring(0,300)}...`);\n\n        if (!quoteData.clientId) {\n          const errorMsg = `Skipped record #${index + 1} (QuoteNumber: ${quoteData.quoteNumber}): ClientID is missing.`;\n          console.warn(`[API_WARN] /api/quotes POST CSV: ${errorMsg}`);\n          importErrors.push(errorMsg);\n          continue;\n        }\n        \n        try {\n          const rawApproverId = quoteData.approverId;\n          const finalApproverId = (rawApproverId === \"\" || rawApproverId === undefined) ? null : rawApproverId;\n\n          await connection.execute(\n            `INSERT INTO Quote (id, quoteNumber, quoteDate, clientId, creatorEmail, subTotal, vatAmount, grandTotal, currency, termsAndConditions, notes, status, approverId, approvalDate, createdAt, updatedAt)\n             VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, NOW(), NOW())`,\n            [\n              quoteData.id, quoteData.quoteNumber, new Date(quoteData.quoteDate as string).toISOString().slice(0, 19).replace('T', ' '), quoteData.clientId, quoteData.creatorEmail,\n              quoteData.subTotal, quoteData.vatAmount, quoteData.grandTotal, quoteData.currency,\n              quoteData.termsAndConditions, quoteData.notes, quoteData.status, finalApproverId,\n              quoteData.approvalDate ? new Date(quoteData.approvalDate).toISOString().slice(0, 19).replace('T', ' ') : null\n            ]\n          );\n          successfulImports++;\n          console.log(`[API_INFO] /api/quotes POST CSV: Successfully processed quote ID: ${quoteData.id}`);\n        } catch (dbError: any) {\n            const errorMsg = `Error importing record #${index + 1} (QuoteNumber ${quoteData.quoteNumber}): ${dbError.message}. SQL Error Code: ${dbError.code || 'N/A'}.`;\n            console.error(`[API_ERROR] /api/quotes POST CSV: Database error for record: ${errorMsg}`, dbError);\n            importErrors.push(errorMsg);\n        }\n      }\n      \n      await connection.commit();\n      console.log('[API_INFO] /api/quotes POST CSV: Database transaction committed.');\n      return NextResponse.json({ \n        message: `${successfulImports} quote header(s) processed from CSV. ${importErrors.length > 0 ? `${importErrors.length} error(s).` : ''}`,\n        errors: importErrors.length > 0 ? importErrors : undefined \n      }, { status: importErrors.length > 0 && successfulImports === 0 ? 400 : 200 });\n\n    } catch (error: any) {\n      if (connection) {\n        try { await connection.rollback(); console.log('[API_INFO] /api/quotes POST CSV: Database transaction rolled back due to error.'); }\n        catch (rbError) { console.error('[API_ERROR] /api/quotes POST CSV: Error during transaction rollback:', rbError); }\n      }\n      console.error('[API_ERROR] /api/quotes POST CSV (outer try-catch):', error);\n      return NextResponse.json({ error: 'Failed to handle quote CSV upload.', details: error.message }, { status: 500 });\n    } finally {\n      if (connection) {\n        try { connection.release(); console.log('[API_INFO] /api/quotes POST CSV: Database connection released.'); }\n        catch (relError) { console.error('[API_ERROR] /api/quotes POST CSV: Error releasing connection:', relError); }\n      }\n    }\n\n  } else if (contentType && contentType.includes('application/json')) {\n    console.log('[API_INFO] /api/quotes POST JSON: Processing application/json request.');\n    let quoteDataFromForm: QuotePayload | null = null;\n    try {\n      quoteDataFromForm = await request.json() as QuotePayload;\n      console.log(`[API_INFO] /api/quotes POST JSON: Received quote data: ${JSON.stringify(quoteDataFromForm).substring(0, 500)}...`);\n      console.log(`[API_INFO] /api/quotes POST JSON: Received approverId: '${quoteDataFromForm.approverId}', Type: ${typeof quoteDataFromForm.approverId}`);\n\n\n      if (!quoteDataFromForm.id || !quoteDataFromForm.clientId || !quoteDataFromForm.quoteNumber) {\n        console.error('[API_ERROR] /api/quotes POST JSON: Missing required fields (id, clientId, quoteNumber). Data:', quoteDataFromForm);\n        return NextResponse.json({ error: 'Quote ID, Client ID, and Quote Number are required.' }, { status: 400 });\n      }\n      \n      console.log('[API_INFO] /api/quotes POST JSON: Attempting to get database connection.');\n      connection = await pool.getConnection();\n      console.log('[API_INFO] /api/quotes POST JSON: Database connection obtained.');\n      await connection.beginTransaction();\n      console.log('[API_INFO] /api/quotes POST JSON: Database transaction started.');\n\n      const rawApproverId = quoteDataFromForm.approverId;\n      const finalApproverId = (rawApproverId === \"\" || rawApproverId === undefined) ? null : rawApproverId;\n      console.log(`[API_INFO] /api/quotes POST JSON: Final approverId for DB: '${finalApproverId}', Type: ${typeof finalApproverId}`);\n\n\n      await connection.execute(\n        `INSERT INTO Quote (id, quoteNumber, quoteDate, clientId, creatorEmail, subTotal, vatAmount, grandTotal, currency, termsAndConditions, notes, status, approverId, approvalDate, createdAt, updatedAt)\n         VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, NOW(), NOW())`,\n        [\n          quoteDataFromForm.id,\n          quoteDataFromForm.quoteNumber,\n          new Date(quoteDataFromForm.quoteDate).toISOString().slice(0, 19).replace('T', ' '),\n          quoteDataFromForm.clientId,\n          quoteDataFromForm.creatorEmail,\n          quoteDataFromForm.subTotal,\n          quoteDataFromForm.vatAmount,\n          quoteDataFromForm.grandTotal,\n          quoteDataFromForm.currency,\n          quoteDataFromForm.termsAndConditions,\n          quoteDataFromForm.notes,\n          quoteDataFromForm.status,\n          finalApproverId, \n          quoteDataFromForm.approvalDate ? new Date(quoteDataFromForm.approvalDate).toISOString().slice(0, 19).replace('T', ' ') : null,\n        ]\n      );\n      console.log(`[API_INFO] /api/quotes POST JSON: Quote header inserted for ID: ${quoteDataFromForm.id}.`);\n\n      if (quoteDataFromForm.items && quoteDataFromForm.items.length > 0) {\n        console.log(`[API_INFO] /api/quotes POST JSON: Processing ${quoteDataFromForm.items.length} items for quote ID: ${quoteDataFromForm.id}.`);\n        for (const item of quoteDataFromForm.items) {\n          await connection.execute(\n            `INSERT INTO QuoteItem (id, quoteId, partNumber, customerRef, description, quantity, unitPrice)\n             VALUES (?, ?, ?, ?, ?, ?, ?)`,\n            [item.id || randomUUID(), quoteDataFromForm.id, item.partNumber, item.customerRef, item.description, item.quantity, item.unitPrice]\n          );\n        }\n        console.log(`[API_INFO] /api/quotes POST JSON: Finished processing items for quote ID: ${quoteDataFromForm.id}.`);\n      } else {\n        console.log(`[API_INFO] /api/quotes POST JSON: No items to process for quote ID: ${quoteDataFromForm.id}.`);\n      }\n\n      await connection.commit();\n      console.log(`[API_INFO] /api/quotes POST JSON: Database transaction committed for quote ID: ${quoteDataFromForm.id}.`);\n      \n      return NextResponse.json({ message: 'Quote saved successfully', quoteId: quoteDataFromForm.id, quoteNumber: quoteDataFromForm.quoteNumber }, { status: 201 });\n\n    } catch (error: any) {\n      if (connection) {\n        try { await connection.rollback(); console.log('[API_INFO] /api/quotes POST JSON: Database transaction rolled back due to error.'); }\n        catch (rbError) { console.error('[API_ERROR] /api/quotes POST JSON: Error during transaction rollback:', rbError); }\n      }\n      const quoteIdentifier = quoteDataFromForm ? `ID ${quoteDataFromForm.id} or Number ${quoteDataFromForm.quoteNumber}` : 'given details';\n      console.error(`[API_ERROR] /api/quotes POST JSON (outer try-catch) for ${quoteIdentifier}:`, error);\n      let errorMessage = `Failed to create quote.`;\n      let errorDetails = error.message;\n      if (error.code === 'ER_DUP_ENTRY') {\n        errorMessage = `Quote with ${quoteIdentifier} already exists.`;\n      } else if (error.code === 'ER_NO_REFERENCED_ROW_2') {\n        errorMessage = `Failed to create quote. Invalid reference to Client or Approver.`;\n        errorDetails = `Client ID '${quoteDataFromForm?.clientId}' or Approver ID '${quoteDataFromForm?.approverId}' might not exist. Specific error: ${error.message}`;\n      } else if (error.code === 'ER_BAD_NULL_ERROR' && error.message.includes('approverId')) {\n        errorMessage = `Failed to create quote. Approver ID cannot be null if trying to set it as foreign key and it's not allowed.`;\n      }\n      \n      console.error(`[API_ERROR_DETAILS] /api/quotes POST JSON: Code: ${error.code}, Message: ${error.message}, Stack: ${error.stack}`);\n      return NextResponse.json({ error: errorMessage, details: errorDetails, code: error.code }, { status: 500 });\n    } finally {\n      if (connection) {\n        try { connection.release(); console.log('[API_INFO] /api/quotes POST JSON: Database connection released.'); }\n        catch (relError) { console.error('[API_ERROR] /api/quotes POST JSON: Error releasing connection:', relError); }\n      }\n    }\n  } else {\n    console.warn(`[API_WARN] /api/quotes POST: Unsupported Content-Type: ${contentType}`);\n    return NextResponse.json({ error: 'Unsupported Content-Type for Quotes POST' }, { status: 415 });\n  }\n}\n\nexport async function GET(request: Request) {\n  console.log('[API_INFO] /api/quotes GET: Request received.');\n  let connection; \n  try {\n    const { searchParams } = new URL(request.url);\n    console.log('[API_INFO] /api/quotes GET: URL parsed successfully.');\n    const month = searchParams.get('month');\n    const year = searchParams.get('year');\n\n    let query = `\n      SELECT \n        q.id, q.quoteNumber, q.quoteDate, q.clientId, q.creatorEmail, \n        q.subTotal, q.vatAmount, q.grandTotal, q.currency, \n        q.termsAndConditions, q.notes, q.status, q.approverId, q.approvalDate,\n        c.name as clientName, c.email as clientEmail,\n        app.name as approverName\n      FROM Quote q\n      LEFT JOIN Client c ON q.clientId = c.id\n      LEFT JOIN Approver app ON q.approverId = app.id\n      WHERE 1=1\n    `;\n    const queryParams: (string | number)[] = [];\n\n    if (month && month !== 'all') {\n      query += ' AND MONTH(q.quoteDate) = ?';\n      queryParams.push(parseInt(month, 10));\n    }\n    if (year && year !== 'all') {\n      query += ' AND YEAR(q.quoteDate) = ?';\n      queryParams.push(parseInt(year, 10));\n    }\n\n    query += ' ORDER BY q.quoteDate DESC, q.quoteNumber DESC';\n    \n    console.log(`[API_INFO] /api/quotes GET: Query constructed. Params: ${JSON.stringify(queryParams)}. Query: ${query.substring(0, 300)}...`);\n    \n    console.log('[API_INFO] /api/quotes GET: Attempting to get database connection...');\n    connection = await pool.getConnection();\n    console.log('[API_INFO] /api/quotes GET: Database connection obtained.');\n\n    console.log('[API_INFO] /api/quotes GET: Attempting to execute query...');\n    const [rows] = await connection.execute(query, queryParams);\n    console.log(`[API_INFO] /api/quotes GET: Query executed. Rows fetched: ${Array.isArray(rows) ? rows.length : 'N/A'}.`);\n    \n    return NextResponse.json(rows);\n\n  } catch (error: unknown) {\n    let errorMessage = 'Failed to fetch quotes due to an unknown server error.';\n    let errorDetails = '';\n    let errorCode = 'UNKNOWN_ERROR';\n    let errorStack = '';\n\n    if (error instanceof Error) {\n      errorMessage = `Failed to fetch quotes: ${error.name}`;\n      errorDetails = error.message;\n      errorStack = error.stack || 'No stack available.';\n      if ((error as any).code) { errorCode = (error as any).code; }\n    } else if (typeof error === 'string') {\n      errorMessage = `Failed to fetch quotes: ${error}`;\n      errorDetails = error;\n    } else if (error && typeof error === 'object' && 'message' in error && typeof error.message === 'string') {\n      errorMessage = `Failed to fetch quotes: Error`;\n      errorDetails = error.message;\n       if ('code' in error && typeof error.code === 'string') errorCode = error.code;\n       if ('stack' in error && typeof error.stack === 'string') errorStack = error.stack;\n    }\n\n    console.error(`[API_ERROR] /api/quotes GET: ${errorMessage}. Details: ${errorDetails}. Code: ${errorCode}.`);\n    console.error(`[API_ERROR_STACK] /api/quotes GET: ${errorStack}`);\n    \n    return NextResponse.json(\n      { \n        error: errorMessage, \n        details: errorDetails, \n        code: errorCode, \n      }, \n      { status: 500 }\n    );\n  } finally {\n    if (connection) {\n      try {\n        console.log('[API_INFO] /api/quotes GET: Attempting to release database connection in finally block.');\n        connection.release();\n        console.log('[API_INFO] /api/quotes GET: Database connection released.');\n      } catch (releaseError: any) {\n        console.error(`[API_ERROR] /api/quotes GET: Error releasing database connection in finally block: ${releaseError.message}`);\n      }\n    }\n    console.log('[API_INFO] /api/quotes GET: Request processing finished.');\n  }\n}\n"],"names":[],"mappings":";;;;AACA;AACA;AAEA;AACA;AACA;;;;;;AAEO,eAAe,KAAK,OAAgB;IACzC,MAAM,cAAc,QAAQ,OAAO,CAAC,GAAG,CAAC;IACxC,IAAI;IACJ,QAAQ,GAAG,CAAC,CAAC,iEAAiE,EAAE,aAAa;IAE7F,IAAI,eAAe,YAAY,QAAQ,CAAC,wBAAwB;QAC9D,QAAQ,GAAG,CAAC;QACZ,IAAI;YACF,MAAM,WAAW,MAAM,QAAQ,QAAQ;YACvC,MAAM,OAAO,SAAS,GAAG,CAAC;YAE1B,IAAI,CAAC,MAAM;gBACT,QAAQ,KAAK,CAAC;gBACd,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;oBAAE,OAAO;gBAA8B,GAAG;oBAAE,QAAQ;gBAAI;YACnF;YACA,QAAQ,GAAG,CAAC,CAAC,gDAAgD,EAAE,KAAK,IAAI,CAAC,QAAQ,EAAE,KAAK,IAAI,CAAC,QAAQ,EAAE,KAAK,IAAI,EAAE;YAElH,MAAM,aAAa,OAAO,IAAI,CAAC,MAAM,KAAK,WAAW;YACrD,MAAM,UAAiB,EAAE;YACzB,MAAM,SAAS,qGAAA,CAAA,WAAQ,CAAC,IAAI,CAAC;YAC7B,IAAI,oBAAoB;YAExB,QAAQ,GAAG,CAAC;YACZ,MAAM,IAAI,QAAc,CAAC,SAAS;gBAChC,OACG,IAAI,CAAC,CAAA,GAAA,wIAAA,CAAA,UAAG,AAAD,EAAE;oBAAE,YAAY,CAAC,EAAE,MAAM,EAAE,GAAK,OAAO,IAAI;gBAAG,IACrD,EAAE,CAAC,WAAW,CAAC,UAAY,QAAQ,GAAG,CAAC,0DAA0D,UACjG,EAAE,CAAC,QAAQ,CAAC;oBACV,IAAI,CAAC,mBAAmB;wBACvB,QAAQ,GAAG,CAAC,wEAAwE;wBACpF,oBAAoB;oBACtB;oBACA,QAAQ,IAAI,CAAC;gBACf,GACC,EAAE,CAAC,OAAO;oBACT,QAAQ,GAAG,CAAC,CAAC,uDAAuD,EAAE,QAAQ,MAAM,CAAC,eAAe,CAAC;oBACrG;gBACF,GACC,EAAE,CAAC,SAAS,CAAC;oBACZ,QAAQ,KAAK,CAAC,+DAA+D;oBAC7E,OAAO;gBACT;YACJ;YAEA,IAAI,QAAQ,MAAM,KAAK,GAAG;gBACxB,QAAQ,IAAI,CAAC;gBACb,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;oBAAE,SAAS;gBAAsD,GAAG;oBAAE,QAAQ;gBAAI;YAC7G;YAEA,QAAQ,GAAG,CAAC;YACZ,aAAa,MAAM,+GAAA,CAAA,OAAI,CAAC,aAAa;YACrC,QAAQ,GAAG,CAAC;YACZ,MAAM,WAAW,gBAAgB;YACjC,QAAQ,GAAG,CAAC;YAEZ,IAAI,oBAAoB;YACxB,MAAM,eAAyB,EAAE;YAEjC,KAAK,MAAM,CAAC,OAAO,OAAO,IAAI,QAAQ,OAAO,GAAI;gBAC/C,MAAM,UAAU,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,CAAA,GAAA,qGAAA,CAAA,aAAU,AAAD;gBACzD,MAAM,YAAmC;oBACvC,IAAI;oBACJ,aAAa,MAAM,CAAC,cAAc,IAAI,CAAC,MAAM,EAAE,QAAQ,KAAK,CAAC,GAAE,IAAI;oBACnE,WAAW,MAAM,CAAC,YAAY,GAAG,IAAI,KAAK,MAAM,CAAC,YAAY,EAAE,WAAW,KAAK,IAAI,OAAO,WAAW;oBACrG,UAAU,MAAM,CAAC,WAAW,IAAI,MAAM,CAAC,WAAW,IAAI,MAAM,CAAC,WAAW;oBACxE,cAAc,MAAM,CAAC,eAAe,IAAI;oBACxC,UAAU,WAAW,MAAM,CAAC,WAAW,IAAI;oBAC3C,WAAW,WAAW,MAAM,CAAC,YAAY,IAAI;oBAC7C,YAAY,WAAW,MAAM,CAAC,aAAa,IAAI;oBAC/C,UAAU,MAAM,CAAC,WAAW,IAAI;oBAChC,oBAAoB,MAAM,CAAC,qBAAqB;oBAChD,OAAO,MAAM,CAAC,QAAQ;oBACtB,QAAS,MAAM,CAAC,SAAS,IAAI;oBAC7B,YAAY,MAAM,CAAC,aAAa,IAAI,MAAM,CAAC,aAAa,IAAI,MAAM,CAAC,aAAa,IAAI;oBACpF,cAAc,MAAM,CAAC,eAAe,GAAG,IAAI,KAAK,MAAM,CAAC,eAAe,EAAE,WAAW,KAAK;gBAC1F;gBAEA,QAAQ,GAAG,CAAC,CAAC,qDAAqD,EAAE,QAAQ,EAAE,EAAE,EAAE,KAAK,SAAS,CAAC,WAAW,SAAS,CAAC,GAAE,KAAK,GAAG,CAAC;gBAEjI,IAAI,CAAC,UAAU,QAAQ,EAAE;oBACvB,MAAM,WAAW,CAAC,gBAAgB,EAAE,QAAQ,EAAE,eAAe,EAAE,UAAU,WAAW,CAAC,uBAAuB,CAAC;oBAC7G,QAAQ,IAAI,CAAC,CAAC,iCAAiC,EAAE,UAAU;oBAC3D,aAAa,IAAI,CAAC;oBAClB;gBACF;gBAEA,IAAI;oBACF,MAAM,gBAAgB,UAAU,UAAU;oBAC1C,MAAM,kBAAkB,AAAC,kBAAkB,MAAM,kBAAkB,YAAa,OAAO;oBAEvF,MAAM,WAAW,OAAO,CACtB,CAAC;4EAC+D,CAAC,EACjE;wBACE,UAAU,EAAE;wBAAE,UAAU,WAAW;wBAAE,IAAI,KAAK,UAAU,SAAS,EAAY,WAAW,GAAG,KAAK,CAAC,GAAG,IAAI,OAAO,CAAC,KAAK;wBAAM,UAAU,QAAQ;wBAAE,UAAU,YAAY;wBACrK,UAAU,QAAQ;wBAAE,UAAU,SAAS;wBAAE,UAAU,UAAU;wBAAE,UAAU,QAAQ;wBACjF,UAAU,kBAAkB;wBAAE,UAAU,KAAK;wBAAE,UAAU,MAAM;wBAAE;wBACjE,UAAU,YAAY,GAAG,IAAI,KAAK,UAAU,YAAY,EAAE,WAAW,GAAG,KAAK,CAAC,GAAG,IAAI,OAAO,CAAC,KAAK,OAAO;qBAC1G;oBAEH;oBACA,QAAQ,GAAG,CAAC,CAAC,kEAAkE,EAAE,UAAU,EAAE,EAAE;gBACjG,EAAE,OAAO,SAAc;oBACnB,MAAM,WAAW,CAAC,wBAAwB,EAAE,QAAQ,EAAE,cAAc,EAAE,UAAU,WAAW,CAAC,GAAG,EAAE,QAAQ,OAAO,CAAC,kBAAkB,EAAE,QAAQ,IAAI,IAAI,MAAM,CAAC,CAAC;oBAC7J,QAAQ,KAAK,CAAC,CAAC,6DAA6D,EAAE,UAAU,EAAE;oBAC1F,aAAa,IAAI,CAAC;gBACtB;YACF;YAEA,MAAM,WAAW,MAAM;YACvB,QAAQ,GAAG,CAAC;YACZ,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBACvB,SAAS,GAAG,kBAAkB,qCAAqC,EAAE,aAAa,MAAM,GAAG,IAAI,GAAG,aAAa,MAAM,CAAC,UAAU,CAAC,GAAG,IAAI;gBACxI,QAAQ,aAAa,MAAM,GAAG,IAAI,eAAe;YACnD,GAAG;gBAAE,QAAQ,aAAa,MAAM,GAAG,KAAK,sBAAsB,IAAI,MAAM;YAAI;QAE9E,EAAE,OAAO,OAAY;YACnB,IAAI,YAAY;gBACd,IAAI;oBAAE,MAAM,WAAW,QAAQ;oBAAI,QAAQ,GAAG,CAAC;gBAAoF,EACnI,OAAO,SAAS;oBAAE,QAAQ,KAAK,CAAC,wEAAwE;gBAAU;YACpH;YACA,QAAQ,KAAK,CAAC,uDAAuD;YACrE,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;gBAAsC,SAAS,MAAM,OAAO;YAAC,GAAG;gBAAE,QAAQ;YAAI;QAClH,SAAU;YACR,IAAI,YAAY;gBACd,IAAI;oBAAE,WAAW,OAAO;oBAAI,QAAQ,GAAG,CAAC;gBAAmE,EAC3G,OAAO,UAAU;oBAAE,QAAQ,KAAK,CAAC,iEAAiE;gBAAW;YAC/G;QACF;IAEF,OAAO,IAAI,eAAe,YAAY,QAAQ,CAAC,qBAAqB;QAClE,QAAQ,GAAG,CAAC;QACZ,IAAI,oBAAyC;QAC7C,IAAI;YACF,oBAAoB,MAAM,QAAQ,IAAI;YACtC,QAAQ,GAAG,CAAC,CAAC,uDAAuD,EAAE,KAAK,SAAS,CAAC,mBAAmB,SAAS,CAAC,GAAG,KAAK,GAAG,CAAC;YAC9H,QAAQ,GAAG,CAAC,CAAC,wDAAwD,EAAE,kBAAkB,UAAU,CAAC,SAAS,EAAE,OAAO,kBAAkB,UAAU,EAAE;YAGpJ,IAAI,CAAC,kBAAkB,EAAE,IAAI,CAAC,kBAAkB,QAAQ,IAAI,CAAC,kBAAkB,WAAW,EAAE;gBAC1F,QAAQ,KAAK,CAAC,iGAAiG;gBAC/G,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;oBAAE,OAAO;gBAAsD,GAAG;oBAAE,QAAQ;gBAAI;YAC3G;YAEA,QAAQ,GAAG,CAAC;YACZ,aAAa,MAAM,+GAAA,CAAA,OAAI,CAAC,aAAa;YACrC,QAAQ,GAAG,CAAC;YACZ,MAAM,WAAW,gBAAgB;YACjC,QAAQ,GAAG,CAAC;YAEZ,MAAM,gBAAgB,kBAAkB,UAAU;YAClD,MAAM,kBAAkB,AAAC,kBAAkB,MAAM,kBAAkB,YAAa,OAAO;YACvF,QAAQ,GAAG,CAAC,CAAC,4DAA4D,EAAE,gBAAgB,SAAS,EAAE,OAAO,iBAAiB;YAG9H,MAAM,WAAW,OAAO,CACtB,CAAC;wEAC+D,CAAC,EACjE;gBACE,kBAAkB,EAAE;gBACpB,kBAAkB,WAAW;gBAC7B,IAAI,KAAK,kBAAkB,SAAS,EAAE,WAAW,GAAG,KAAK,CAAC,GAAG,IAAI,OAAO,CAAC,KAAK;gBAC9E,kBAAkB,QAAQ;gBAC1B,kBAAkB,YAAY;gBAC9B,kBAAkB,QAAQ;gBAC1B,kBAAkB,SAAS;gBAC3B,kBAAkB,UAAU;gBAC5B,kBAAkB,QAAQ;gBAC1B,kBAAkB,kBAAkB;gBACpC,kBAAkB,KAAK;gBACvB,kBAAkB,MAAM;gBACxB;gBACA,kBAAkB,YAAY,GAAG,IAAI,KAAK,kBAAkB,YAAY,EAAE,WAAW,GAAG,KAAK,CAAC,GAAG,IAAI,OAAO,CAAC,KAAK,OAAO;aAC1H;YAEH,QAAQ,GAAG,CAAC,CAAC,gEAAgE,EAAE,kBAAkB,EAAE,CAAC,CAAC,CAAC;YAEtG,IAAI,kBAAkB,KAAK,IAAI,kBAAkB,KAAK,CAAC,MAAM,GAAG,GAAG;gBACjE,QAAQ,GAAG,CAAC,CAAC,6CAA6C,EAAE,kBAAkB,KAAK,CAAC,MAAM,CAAC,qBAAqB,EAAE,kBAAkB,EAAE,CAAC,CAAC,CAAC;gBACzI,KAAK,MAAM,QAAQ,kBAAkB,KAAK,CAAE;oBAC1C,MAAM,WAAW,OAAO,CACtB,CAAC;yCAC4B,CAAC,EAC9B;wBAAC,KAAK,EAAE,IAAI,CAAA,GAAA,qGAAA,CAAA,aAAU,AAAD;wBAAK,kBAAkB,EAAE;wBAAE,KAAK,UAAU;wBAAE,KAAK,WAAW;wBAAE,KAAK,WAAW;wBAAE,KAAK,QAAQ;wBAAE,KAAK,SAAS;qBAAC;gBAEvI;gBACA,QAAQ,GAAG,CAAC,CAAC,0EAA0E,EAAE,kBAAkB,EAAE,CAAC,CAAC,CAAC;YAClH,OAAO;gBACL,QAAQ,GAAG,CAAC,CAAC,oEAAoE,EAAE,kBAAkB,EAAE,CAAC,CAAC,CAAC;YAC5G;YAEA,MAAM,WAAW,MAAM;YACvB,QAAQ,GAAG,CAAC,CAAC,+EAA+E,EAAE,kBAAkB,EAAE,CAAC,CAAC,CAAC;YAErH,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAA4B,SAAS,kBAAkB,EAAE;gBAAE,aAAa,kBAAkB,WAAW;YAAC,GAAG;gBAAE,QAAQ;YAAI;QAE7J,EAAE,OAAO,OAAY;YACnB,IAAI,YAAY;gBACd,IAAI;oBAAE,MAAM,WAAW,QAAQ;oBAAI,QAAQ,GAAG,CAAC;gBAAqF,EACpI,OAAO,SAAS;oBAAE,QAAQ,KAAK,CAAC,yEAAyE;gBAAU;YACrH;YACA,MAAM,kBAAkB,oBAAoB,CAAC,GAAG,EAAE,kBAAkB,EAAE,CAAC,WAAW,EAAE,kBAAkB,WAAW,EAAE,GAAG;YACtH,QAAQ,KAAK,CAAC,CAAC,wDAAwD,EAAE,gBAAgB,CAAC,CAAC,EAAE;YAC7F,IAAI,eAAe,CAAC,uBAAuB,CAAC;YAC5C,IAAI,eAAe,MAAM,OAAO;YAChC,IAAI,MAAM,IAAI,KAAK,gBAAgB;gBACjC,eAAe,CAAC,WAAW,EAAE,gBAAgB,gBAAgB,CAAC;YAChE,OAAO,IAAI,MAAM,IAAI,KAAK,0BAA0B;gBAClD,eAAe,CAAC,gEAAgE,CAAC;gBACjF,eAAe,CAAC,WAAW,EAAE,mBAAmB,SAAS,kBAAkB,EAAE,mBAAmB,WAAW,mCAAmC,EAAE,MAAM,OAAO,EAAE;YACjK,OAAO,IAAI,MAAM,IAAI,KAAK,uBAAuB,MAAM,OAAO,CAAC,QAAQ,CAAC,eAAe;gBACrF,eAAe,CAAC,2GAA2G,CAAC;YAC9H;YAEA,QAAQ,KAAK,CAAC,CAAC,iDAAiD,EAAE,MAAM,IAAI,CAAC,WAAW,EAAE,MAAM,OAAO,CAAC,SAAS,EAAE,MAAM,KAAK,EAAE;YAChI,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;gBAAc,SAAS;gBAAc,MAAM,MAAM,IAAI;YAAC,GAAG;gBAAE,QAAQ;YAAI;QAC3G,SAAU;YACR,IAAI,YAAY;gBACd,IAAI;oBAAE,WAAW,OAAO;oBAAI,QAAQ,GAAG,CAAC;gBAAoE,EAC5G,OAAO,UAAU;oBAAE,QAAQ,KAAK,CAAC,kEAAkE;gBAAW;YAChH;QACF;IACF,OAAO;QACL,QAAQ,IAAI,CAAC,CAAC,uDAAuD,EAAE,aAAa;QACpF,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA2C,GAAG;YAAE,QAAQ;QAAI;IAChG;AACF;AAEO,eAAe,IAAI,OAAgB;IACxC,QAAQ,GAAG,CAAC;IACZ,IAAI;IACJ,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,QAAQ,GAAG,CAAC;QACZ,MAAM,QAAQ,aAAa,GAAG,CAAC;QAC/B,MAAM,OAAO,aAAa,GAAG,CAAC;QAE9B,IAAI,QAAQ,CAAC;;;;;;;;;;;IAWb,CAAC;QACD,MAAM,cAAmC,EAAE;QAE3C,IAAI,SAAS,UAAU,OAAO;YAC5B,SAAS;YACT,YAAY,IAAI,CAAC,SAAS,OAAO;QACnC;QACA,IAAI,QAAQ,SAAS,OAAO;YAC1B,SAAS;YACT,YAAY,IAAI,CAAC,SAAS,MAAM;QAClC;QAEA,SAAS;QAET,QAAQ,GAAG,CAAC,CAAC,uDAAuD,EAAE,KAAK,SAAS,CAAC,aAAa,SAAS,EAAE,MAAM,SAAS,CAAC,GAAG,KAAK,GAAG,CAAC;QAEzI,QAAQ,GAAG,CAAC;QACZ,aAAa,MAAM,+GAAA,CAAA,OAAI,CAAC,aAAa;QACrC,QAAQ,GAAG,CAAC;QAEZ,QAAQ,GAAG,CAAC;QACZ,MAAM,CAAC,KAAK,GAAG,MAAM,WAAW,OAAO,CAAC,OAAO;QAC/C,QAAQ,GAAG,CAAC,CAAC,0DAA0D,EAAE,MAAM,OAAO,CAAC,QAAQ,KAAK,MAAM,GAAG,MAAM,CAAC,CAAC;QAErH,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;IAE3B,EAAE,OAAO,OAAgB;QACvB,IAAI,eAAe;QACnB,IAAI,eAAe;QACnB,IAAI,YAAY;QAChB,IAAI,aAAa;QAEjB,IAAI,iBAAiB,OAAO;YAC1B,eAAe,CAAC,wBAAwB,EAAE,MAAM,IAAI,EAAE;YACtD,eAAe,MAAM,OAAO;YAC5B,aAAa,MAAM,KAAK,IAAI;YAC5B,IAAI,AAAC,MAAc,IAAI,EAAE;gBAAE,YAAY,AAAC,MAAc,IAAI;YAAE;QAC9D,OAAO,IAAI,OAAO,UAAU,UAAU;YACpC,eAAe,CAAC,wBAAwB,EAAE,OAAO;YACjD,eAAe;QACjB,OAAO,IAAI,SAAS,OAAO,UAAU,YAAY,aAAa,SAAS,OAAO,MAAM,OAAO,KAAK,UAAU;YACxG,eAAe,CAAC,6BAA6B,CAAC;YAC9C,eAAe,MAAM,OAAO;YAC3B,IAAI,UAAU,SAAS,OAAO,MAAM,IAAI,KAAK,UAAU,YAAY,MAAM,IAAI;YAC7E,IAAI,WAAW,SAAS,OAAO,MAAM,KAAK,KAAK,UAAU,aAAa,MAAM,KAAK;QACpF;QAEA,QAAQ,KAAK,CAAC,CAAC,6BAA6B,EAAE,aAAa,WAAW,EAAE,aAAa,QAAQ,EAAE,UAAU,CAAC,CAAC;QAC3G,QAAQ,KAAK,CAAC,CAAC,mCAAmC,EAAE,YAAY;QAEhE,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YACE,OAAO;YACP,SAAS;YACT,MAAM;QACR,GACA;YAAE,QAAQ;QAAI;IAElB,SAAU;QACR,IAAI,YAAY;YACd,IAAI;gBACF,QAAQ,GAAG,CAAC;gBACZ,WAAW,OAAO;gBAClB,QAAQ,GAAG,CAAC;YACd,EAAE,OAAO,cAAmB;gBAC1B,QAAQ,KAAK,CAAC,CAAC,mFAAmF,EAAE,aAAa,OAAO,EAAE;YAC5H;QACF;QACA,QAAQ,GAAG,CAAC;IACd;AACF","debugId":null}}]
}