{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 158, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/backend/db.js"],"sourcesContent":["\nimport mysql from 'mysql2/promise';\n\n// Check for essential DB environment variables\nconst essentialEnvVars = ['DB_HOST', 'DB_USER', 'DB_PASSWORD', 'DB_NAME'];\nconst missingEnvVars = essentialEnvVars.filter(v => !process.env[v]);\n\nif (missingEnvVars.length > 0) {\n    console.error(`CRITICAL_DB_INIT_ERROR: Missing essential database environment variables: ${missingEnvVars.join(', ')}. These should be defined in your hosting environment or a root .env.local file. Database connections will fail.`);\n    throw new Error(`Missing critical DB environment variables: ${missingEnvVars.join(', ')}. Check your environment configuration.`);\n}\n\n// The CA certificate content is now expected to be in an environment variable.\nconst caCert = process.env.DB_SSL_CA;\n\nif (!caCert) {\n    console.warn(`DB_WARN: The DB_SSL_CA environment variable is not set. Database connections may fail if SSL is required by your provider. For local development without SSL, this may be ignored.`);\n}\n\nlet pool;\ntry {\n  pool = mysql.createPool({\n    host: process.env.DB_HOST,\n    user: process.env.DB_USER,\n    password: process.env.DB_PASSWORD,\n    database: process.env.DB_NAME,\n    port: process.env.DB_PORT ? parseInt(process.env.DB_PORT, 10) : 3306,\n    // Conditionally add SSL options only if the certificate is provided.\n    ...(caCert && {\n      ssl: {\n        ca: caCert,\n        rejectUnauthorized: true, // Recommended for production if using a trusted CA\n      }\n    }),\n    waitForConnections: true,\n    connectionLimit: 10,\n    queueLimit: 0,\n  });\n  console.log(\"DB_INIT_SUCCESS: MySQL connection pool created (this does not guarantee successful connection yet, but configuration is loaded).\");\n} catch (error) {\n  console.error(`CRITICAL_DB_INIT_ERROR: Failed to create MySQL connection pool: ${error.message}. This is a fatal error for database operations.`);\n  throw new Error(`Failed to initialize database connection pool due to: ${error.message}. Review DB environment variables.`);\n}\n\n// Export the connection pool\nexport { pool };\n"],"names":[],"mappings":";;;AACA;;AAEA,+CAA+C;AAC/C,MAAM,mBAAmB;IAAC;IAAW;IAAW;IAAe;CAAU;AACzE,MAAM,iBAAiB,iBAAiB,MAAM,CAAC,CAAA,IAAK,CAAC,QAAQ,GAAG,CAAC,EAAE;AAEnE,IAAI,eAAe,MAAM,GAAG,GAAG;IAC3B,QAAQ,KAAK,CAAC,CAAC,0EAA0E,EAAE,eAAe,IAAI,CAAC,MAAM,gHAAgH,CAAC;IACtO,MAAM,IAAI,MAAM,CAAC,2CAA2C,EAAE,eAAe,IAAI,CAAC,MAAM,uCAAuC,CAAC;AACpI;AAEA,+EAA+E;AAC/E,MAAM,SAAS,QAAQ,GAAG,CAAC,SAAS;AAEpC,IAAI,CAAC,QAAQ;IACT,QAAQ,IAAI,CAAC,CAAC,kLAAkL,CAAC;AACrM;AAEA,IAAI;AACJ,IAAI;IACF,OAAO,mIAAA,CAAA,UAAK,CAAC,UAAU,CAAC;QACtB,MAAM,QAAQ,GAAG,CAAC,OAAO;QACzB,MAAM,QAAQ,GAAG,CAAC,OAAO;QACzB,UAAU,QAAQ,GAAG,CAAC,WAAW;QACjC,UAAU,QAAQ,GAAG,CAAC,OAAO;QAC7B,MAAM,QAAQ,GAAG,CAAC,OAAO,GAAG,SAAS,QAAQ,GAAG,CAAC,OAAO,EAAE,MAAM;QAChE,qEAAqE;QACrE,GAAI,UAAU;YACZ,KAAK;gBACH,IAAI;gBACJ,oBAAoB;YACtB;QACF,CAAC;QACD,oBAAoB;QACpB,iBAAiB;QACjB,YAAY;IACd;IACA,QAAQ,GAAG,CAAC;AACd,EAAE,OAAO,OAAO;IACd,QAAQ,KAAK,CAAC,CAAC,gEAAgE,EAAE,MAAM,OAAO,CAAC,gDAAgD,CAAC;IAChJ,MAAM,IAAI,MAAM,CAAC,sDAAsD,EAAE,MAAM,OAAO,CAAC,kCAAkC,CAAC;AAC5H","debugId":null}},
    {"offset": {"line": 211, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/api/charts/site-po-value-status/route.ts"],"sourcesContent":["\nimport { NextResponse } from 'next/server';\nimport { pool } from '../../../../../backend/db.js'; \nimport type { ChartDataPoint, PurchaseOrderStatus } from '@/types';\n\ninterface SitePOValueQueryResult {\n  site_identifier: string; \n  status: PurchaseOrderStatus; \n  total_value: number | string; \n  po_id: number; \n}\n\nexport async function GET(request: Request) {\n  const { searchParams } = new URL(request.url);\n  const month = searchParams.get('month');\n  const year = searchParams.get('year');\n  \n  let connection;\n  try {\n    connection = await pool.getConnection();\n    \n    let poWhereClauses: string[] = [\"po.status IN ('Pending Approval', 'Approved')\"];\n    const queryParams: (string | number)[] = [];\n\n    if (month && month !== 'all') {\n      poWhereClauses.push(\"MONTH(po.creationDate) = ?\");\n      queryParams.push(parseInt(month, 10));\n    }\n    if (year && year !== 'all') {\n      poWhereClauses.push(\"YEAR(po.creationDate) = ?\");\n      queryParams.push(parseInt(year, 10));\n    }\n    \n    const poWhereString = poWhereClauses.length > 0 ? `WHERE ${poWhereClauses.join(' AND ')}` : '';\n    \n    const poQuery = `\n      SELECT \n        po.id as po_id,\n        COALESCE(s.siteCode, s.name, 'Unassigned') as site_identifier,\n        po.status,\n        po.grandTotal as total_value\n      FROM PurchaseOrder po\n      LEFT JOIN POItem poi ON po.id = poi.poId \n      LEFT JOIN Site s ON poi.siteId = s.id \n      ${poWhereString}\n      GROUP BY po.id, site_identifier, po.status, po.grandTotal \n      ORDER BY site_identifier ASC, po.status ASC;\n    `;\n    const [poRows]: any[] = await connection.execute(poQuery, queryParams);\n\n    const siteData: { [key: string]: ChartDataPoint } = {};\n    const siteOrder: string[] = [];\n\n    for (const po of poRows as Array<Omit<SitePOValueQueryResult, 'total_value'> & {total_value: number | string | null}>) {\n      const siteIdentifier = po.site_identifier;\n      if (!siteData[siteIdentifier]) {\n        siteData[siteIdentifier] = { \n          name: siteIdentifier,\n          'ApprovedValue': 0,      \n          'PendingApprovalValue': 0    \n        };\n        if (!siteOrder.includes(siteIdentifier)) {\n          siteOrder.push(siteIdentifier);\n        }\n      }\n\n      const poValue = Number(po.total_value) || 0;\n      const currentStatus = po.status ? po.status.trim() as PurchaseOrderStatus : 'Draft';\n\n      if (currentStatus === 'Pending Approval') {\n        siteData[siteIdentifier]['PendingApprovalValue'] = (siteData[siteIdentifier]['PendingApprovalValue'] as number) + poValue;\n      } else if (currentStatus === 'Approved') {\n         siteData[siteIdentifier]['ApprovedValue'] = (siteData[siteIdentifier]['ApprovedValue'] as number) + poValue;\n      }\n    }\n    \n    siteOrder.sort();\n    const chartData = siteOrder.map(siteIdentifier => siteData[siteIdentifier]);\n\n    return NextResponse.json(chartData);\n\n  } catch (error: any) {\n    console.error('Error fetching site PO value status data:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch site PO value status data', details: error.message },\n      { status: 500 }\n    );\n  } finally {\n    if (connection) connection.release();\n  }\n}\n"],"names":[],"mappings":";;;AACA;AACA;;;AAUO,eAAe,IAAI,OAAgB;IACxC,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAC5C,MAAM,QAAQ,aAAa,GAAG,CAAC;IAC/B,MAAM,OAAO,aAAa,GAAG,CAAC;IAE9B,IAAI;IACJ,IAAI;QACF,aAAa,MAAM,+GAAA,CAAA,OAAI,CAAC,aAAa;QAErC,IAAI,iBAA2B;YAAC;SAAgD;QAChF,MAAM,cAAmC,EAAE;QAE3C,IAAI,SAAS,UAAU,OAAO;YAC5B,eAAe,IAAI,CAAC;YACpB,YAAY,IAAI,CAAC,SAAS,OAAO;QACnC;QACA,IAAI,QAAQ,SAAS,OAAO;YAC1B,eAAe,IAAI,CAAC;YACpB,YAAY,IAAI,CAAC,SAAS,MAAM;QAClC;QAEA,MAAM,gBAAgB,eAAe,MAAM,GAAG,IAAI,CAAC,MAAM,EAAE,eAAe,IAAI,CAAC,UAAU,GAAG;QAE5F,MAAM,UAAU,CAAC;;;;;;;;;MASf,EAAE,cAAc;;;IAGlB,CAAC;QACD,MAAM,CAAC,OAAO,GAAU,MAAM,WAAW,OAAO,CAAC,SAAS;QAE1D,MAAM,WAA8C,CAAC;QACrD,MAAM,YAAsB,EAAE;QAE9B,KAAK,MAAM,MAAM,OAAsG;YACrH,MAAM,iBAAiB,GAAG,eAAe;YACzC,IAAI,CAAC,QAAQ,CAAC,eAAe,EAAE;gBAC7B,QAAQ,CAAC,eAAe,GAAG;oBACzB,MAAM;oBACN,iBAAiB;oBACjB,wBAAwB;gBAC1B;gBACA,IAAI,CAAC,UAAU,QAAQ,CAAC,iBAAiB;oBACvC,UAAU,IAAI,CAAC;gBACjB;YACF;YAEA,MAAM,UAAU,OAAO,GAAG,WAAW,KAAK;YAC1C,MAAM,gBAAgB,GAAG,MAAM,GAAG,GAAG,MAAM,CAAC,IAAI,KAA4B;YAE5E,IAAI,kBAAkB,oBAAoB;gBACxC,QAAQ,CAAC,eAAe,CAAC,uBAAuB,GAAG,AAAC,QAAQ,CAAC,eAAe,CAAC,uBAAuB,GAAc;YACpH,OAAO,IAAI,kBAAkB,YAAY;gBACtC,QAAQ,CAAC,eAAe,CAAC,gBAAgB,GAAG,AAAC,QAAQ,CAAC,eAAe,CAAC,gBAAgB,GAAc;YACvG;QACF;QAEA,UAAU,IAAI;QACd,MAAM,YAAY,UAAU,GAAG,CAAC,CAAA,iBAAkB,QAAQ,CAAC,eAAe;QAE1E,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;IAE3B,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,6CAA6C;QAC3D,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAA6C,SAAS,MAAM,OAAO;QAAC,GAC7E;YAAE,QAAQ;QAAI;IAElB,SAAU;QACR,IAAI,YAAY,WAAW,OAAO;IACpC;AACF","debugId":null}}]
}