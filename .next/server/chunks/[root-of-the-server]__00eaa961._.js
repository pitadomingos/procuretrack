module.exports = {

"[project]/.next-internal/server/app/api/fuel-records/route/actions.js [app-rsc] (server actions loader, ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({});
}}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/@opentelemetry/api [external] (@opentelemetry/api, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("@opentelemetry/api", () => require("@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/events [external] (events, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}}),
"[externals]/process [external] (process, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("process", () => require("process"));

module.exports = mod;
}}),
"[externals]/net [external] (net, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}}),
"[externals]/tls [external] (tls, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}}),
"[externals]/timers [external] (timers, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("timers", () => require("timers"));

module.exports = mod;
}}),
"[externals]/stream [external] (stream, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}}),
"[externals]/buffer [external] (buffer, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}}),
"[externals]/string_decoder [external] (string_decoder, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("string_decoder", () => require("string_decoder"));

module.exports = mod;
}}),
"[externals]/crypto [external] (crypto, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}}),
"[externals]/zlib [external] (zlib, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}}),
"[externals]/util [external] (util, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}}),
"[externals]/url [external] (url, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}}),
"[externals]/fs [external] (fs, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}}),
"[externals]/path [external] (path, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}}),
"[externals]/os [external] (os, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}}),
"[project]/backend/db.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "getDbPool": (()=>getDbPool)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$mysql2$2f$promise$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/mysql2/promise.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/fs [external] (fs, cjs)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/path [external] (path, cjs)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$dotenv$2f$lib$2f$main$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/dotenv/lib/main.js [app-route] (ecmascript)");
;
;
;
;
// Configure dotenv to load the .env file from the backend directory
__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$dotenv$2f$lib$2f$main$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].config({
    path: __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__["default"].resolve(process.cwd(), 'backend', '.env')
});
let pool = null;
async function getDbPool() {
    if (pool) {
        return pool;
    }
    // --- Debugging Environment ---
    console.log('[DB_INIT] Current working directory:', process.cwd());
    console.log('[DB_INIT] Checking for environment variables...');
    try {
        // Check for essential DB environment variables
        const essentialEnvVars = [
            'DB_HOST',
            'DB_USER',
            'DB_PASSWORD',
            'DB_NAME'
        ];
        const missingEnvVars = [];
        for (const v of essentialEnvVars){
            if (!process.env[v]) {
                missingEnvVars.push(v);
            } else {
                // Avoid logging password in production
                if (v !== 'DB_PASSWORD') {
                    console.log(`[DB_INIT] Found ENV VAR: ${v} = ${process.env[v]}`);
                } else {
                    console.log(`[DB_INIT] Found ENV VAR: DB_PASSWORD = (hidden)`);
                }
            }
        }
        if (missingEnvVars.length > 0) {
            const errorMsg = `Database configuration is incomplete. Missing variables: ${missingEnvVars.join(', ')}. Please define these in your root .env file.`;
            console.error(`[DB_INIT_ERROR] ${errorMsg}`);
            throw new Error(errorMsg);
        }
        // --- SSL Certificate Handling ---
        const caCertPathOrContent = process.env.DB_SSL_CA;
        let caCertContent;
        if (caCertPathOrContent) {
            const potentialPath = __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__["default"].resolve(process.cwd(), caCertPathOrContent);
            if (__TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["default"].existsSync(potentialPath) && __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["default"].statSync(potentialPath).isFile()) {
                console.log(`DB_INIT_INFO: DB_SSL_CA points to a file. Reading certificate from "${potentialPath}".`);
                caCertContent = __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["default"].readFileSync(potentialPath, 'utf8');
            } else {
                console.log("DB_INIT_INFO: DB_SSL_CA does not appear to be a file path. Using its content directly for SSL connection.");
                caCertContent = caCertPathOrContent;
            }
        } else {
            console.warn(`DB_WARN: The DB_SSL_CA environment variable is not set. Connecting with SSL using system default CAs. If connection fails, please provide the path to your 'ca.pem' file in the DB_SSL_CA variable in your .env file.`);
        }
        const sslConfig = {
            rejectUnauthorized: true,
            ca: caCertContent || undefined
        };
        // --- Connection Pool Creation ---
        console.log("DB_INIT_INFO: Creating database connection pool for the first time.");
        const newPool = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$mysql2$2f$promise$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].createPool({
            host: process.env.DB_HOST,
            user: process.env.DB_USER,
            password: process.env.DB_PASSWORD,
            database: process.env.DB_NAME,
            port: process.env.DB_PORT ? parseInt(process.env.DB_PORT, 10) : 3306,
            ssl: sslConfig,
            waitForConnections: true,
            connectionLimit: 10,
            queueLimit: 0
        });
        try {
            // Test the connection before assigning it to the singleton
            const connection = await newPool.getConnection();
            console.log("DB_INIT_SUCCESS: Database connection pool created and verified successfully.");
            connection.release();
        } catch (testError) {
            console.error("CRITICAL_DB_INIT_ERROR: Failed to get a connection from the pool after creation.", testError);
            // Destroy the pool if the initial connection test fails
            newPool.end();
            throw testError; // Re-throw to be caught by the main catch block
        }
        pool = newPool;
        return pool;
    } catch (error) {
        console.error(`CRITICAL_DB_INIT_ERROR: Failed to create and verify database connection pool. Error: ${error.message}`);
        // Re-throw the error to be caught by the calling API route
        throw error;
    }
}
;
}}),
"[project]/src/app/api/fuel-records/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "GET": (()=>GET),
    "POST": (()=>POST)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$backend$2f$db$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/backend/db.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$csv$2d$parser$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/csv-parser/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$stream__$5b$external$5d$__$28$stream$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/stream [external] (stream, cjs)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$crypto__$5b$external$5d$__$28$crypto$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/crypto [external] (crypto, cjs)");
;
;
;
;
;
async function POST(request) {
    const contentType = request.headers.get('content-type');
    let connection;
    const pool = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$backend$2f$db$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDbPool"])();
    if (contentType && contentType.includes('multipart/form-data')) {
        console.log('[API_INFO] /api/fuel-records POST: Received multipart/form-data for CSV upload.');
        try {
            connection = await pool.getConnection();
            const formData = await request.formData();
            const file = formData.get('file');
            if (!file) return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'No file uploaded'
            }, {
                status: 400
            });
            const fileBuffer = Buffer.from(await file.arrayBuffer());
            const results = [];
            const stream = __TURBOPACK__imported__module__$5b$externals$5d2f$stream__$5b$external$5d$__$28$stream$2c$__cjs$29$__["Readable"].from(fileBuffer);
            await new Promise((resolve, reject)=>{
                stream.pipe((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$csv$2d$parser$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])({
                    mapHeaders: ({ header })=>header.trim().toLowerCase()
                })).on('data', (data)=>results.push(data)).on('end', resolve).on('error', reject);
            });
            if (results.length === 0) return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                message: 'CSV file is empty.'
            }, {
                status: 400
            });
            const [tags] = await connection.execute('SELECT id, tagNumber FROM Tag');
            const [sites] = await connection.execute('SELECT id, siteCode FROM Site');
            const tagMap = new Map(tags.map((t)=>[
                    t.tagNumber.toLowerCase(),
                    t.id
                ]));
            const siteMap = new Map(sites.map((s)=>[
                    s.siteCode?.toLowerCase(),
                    s.id
                ]));
            await connection.beginTransaction();
            let successfulImports = 0;
            let failedImports = 0;
            const errors = [];
            for (const [index, record] of results.entries()){
                const tagNumber = record.tagnumber || record['tag number'];
                const siteCode = record.sitecode || record['site code'];
                const fuelDate = record.fueldate || record.date;
                const quantity = record.quantity ? parseFloat(record.quantity) : null;
                const unitCost = record.unitcost || record['unit cost'] ? parseFloat(record.unitcost || record['unit cost']) : null;
                if (!tagNumber || !fuelDate || !quantity || !unitCost) {
                    failedImports++;
                    errors.push(`Skipped row ${index + 2}: Missing required fields (TagNumber, FuelDate, Quantity, UnitCost).`);
                    continue;
                }
                const tagId = tagMap.get(tagNumber.toLowerCase());
                const siteId = siteCode ? siteMap.get(siteCode.toLowerCase()) : null;
                if (!tagId) {
                    failedImports++;
                    errors.push(`Skipped row ${index + 2}: TagNumber "${tagNumber}" not found in database.`);
                    continue;
                }
                const recordId = record.id || (0, __TURBOPACK__imported__module__$5b$externals$5d2f$crypto__$5b$external$5d$__$28$crypto$2c$__cjs$29$__["randomUUID"])();
                try {
                    const query = `
                    INSERT INTO FuelRecord (id, fuelDate, reqNo, invNo, driver, odometer, tagId, siteId, description, uom, quantity, unitCost, recorderUserId, createdAt, updatedAt)
                    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, NOW(), NOW())
                    ON DUPLICATE KEY UPDATE 
                        fuelDate=VALUES(fuelDate), reqNo=VALUES(reqNo), invNo=VALUES(invNo), driver=VALUES(driver), odometer=VALUES(odometer), tagId=VALUES(tagId), siteId=VALUES(siteId), 
                        description=VALUES(description), uom=VALUES(uom), quantity=VALUES(quantity), unitCost=VALUES(unitCost), recorderUserId=VALUES(recorderUserId), updatedAt=NOW()`;
                    await connection.execute(query, [
                        recordId,
                        new Date(fuelDate).toISOString().slice(0, 19).replace('T', ' '),
                        record.reqno || null,
                        record.invno || null,
                        record.driver || null,
                        record.odometer ? parseInt(record.odometer, 10) : null,
                        tagId,
                        siteId,
                        record.description || null,
                        record.uom || 'Liters',
                        quantity,
                        unitCost,
                        record.recorderuserid || 'CSV_IMPORT'
                    ]);
                    successfulImports++;
                } catch (dbError) {
                    failedImports++;
                    errors.push(`Row ${index + 2} (ID ${recordId}): DB Error - ${dbError.message}`);
                }
            }
            await connection.commit();
            let message = `${successfulImports} record(s) processed. ${failedImports} failed.`;
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                message,
                errors: errors.length > 0 ? errors : undefined
            }, {
                status: failedImports > 0 ? 207 : 200
            });
        } catch (error) {
            if (connection) await connection.rollback();
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Failed to handle fuel record CSV upload.',
                details: error.message
            }, {
                status: 500
            });
        } finally{
            if (connection) connection.release();
        }
    } else if (contentType && contentType.includes('application/json')) {
        try {
            const fuelData = await request.json();
            const recordId = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$crypto__$5b$external$5d$__$28$crypto$2c$__cjs$29$__["randomUUID"])();
            const query = `
        INSERT INTO FuelRecord (id, fuelDate, reqNo, invNo, driver, odometer, tagId, siteId, description, uom, quantity, unitCost, recorderUserId, createdAt, updatedAt)
        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, NOW(), NOW())
      `;
            await pool.execute(query, [
                recordId,
                new Date(fuelData.fuelDate).toISOString().slice(0, 19).replace('T', ' '),
                fuelData.reqNo || null,
                fuelData.invNo || null,
                fuelData.driver || null,
                fuelData.odometer ? Number(fuelData.odometer) : null,
                fuelData.tagId,
                fuelData.siteId ? Number(fuelData.siteId) : null,
                fuelData.description || 'Diesel',
                fuelData.uom || 'Liters',
                Number(fuelData.quantity),
                Number(fuelData.unitCost),
                fuelData.recorderUserId || null
            ]);
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                message: 'Fuel record saved successfully.',
                fuelRecordId: recordId
            }, {
                status: 201
            });
        } catch (error) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Failed to create fuel record.',
                details: error.message,
                code: error.code
            }, {
                status: 500
            });
        }
    } else {
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Unsupported Content-Type'
        }, {
            status: 415
        });
    }
}
async function GET(request) {
    const { searchParams } = new URL(request.url);
    const month = searchParams.get('month');
    const year = searchParams.get('year');
    const siteIdParam = searchParams.get('siteId');
    const tagIdParam = searchParams.get('tagId');
    const driver = searchParams.get('driver');
    let connection;
    try {
        const pool = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$backend$2f$db$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDbPool"])();
        connection = await pool.getConnection();
        let query = `
      SELECT 
        fr.id, fr.fuelDate, fr.reqNo, fr.invNo, fr.driver, fr.odometer, fr.tagId, 
        fr.siteId, fr.description, fr.uom, fr.quantity, fr.unitCost,
        t.tagNumber as tagName, s.siteCode as siteName
      FROM FuelRecord fr
      JOIN Tag t ON fr.tagId = t.id
      LEFT JOIN Site s ON fr.siteId = s.id
      WHERE 1=1
    `;
        const queryParams = [];
        if (month && month !== 'all') {
            query += ' AND MONTH(fr.fuelDate) = ?';
            queryParams.push(parseInt(month, 10));
        }
        if (year && year !== 'all') {
            query += ' AND YEAR(fr.fuelDate) = ?';
            queryParams.push(parseInt(year, 10));
        }
        if (siteIdParam && siteIdParam !== 'all') {
            query += ' AND fr.siteId = ?';
            queryParams.push(parseInt(siteIdParam, 10));
        }
        if (tagIdParam && tagIdParam !== 'all') {
            query += ' AND fr.tagId = ?';
            queryParams.push(tagIdParam);
        }
        if (driver && driver.trim() !== '') {
            query += ' AND fr.driver LIKE ?';
            queryParams.push(`%${driver.trim()}%`);
        }
        query += ' ORDER BY fr.tagId, fr.fuelDate ASC, fr.odometer ASC';
        const [rows] = await connection.execute(query, queryParams);
        const recordsByTag = {};
        rows.forEach((rec)=>{
            if (!recordsByTag[rec.tagId]) {
                recordsByTag[rec.tagId] = [];
            }
            recordsByTag[rec.tagId].push(rec);
        });
        const recordsWithDistance = [];
        for(const tagId in recordsByTag){
            const tagRecords = recordsByTag[tagId]; // Already sorted by date/odometer
            for(let i = 0; i < tagRecords.length; i++){
                const currentRecord = tagRecords[i];
                let distanceTravelled = null;
                if (i > 0 && currentRecord.odometer && tagRecords[i - 1].odometer) {
                    distanceTravelled = currentRecord.odometer - tagRecords[i - 1].odometer;
                }
                recordsWithDistance.push({
                    ...currentRecord,
                    quantity: parseFloat(currentRecord.quantity),
                    unitCost: parseFloat(currentRecord.unitCost),
                    totalCost: parseFloat(currentRecord.quantity) * parseFloat(currentRecord.unitCost),
                    distanceTravelled: distanceTravelled
                });
            }
        }
        recordsWithDistance.sort((a, b)=>new Date(b.fuelDate).getTime() - new Date(a.fuelDate).getTime());
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(recordsWithDistance);
    } catch (error) {
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Failed to fetch fuel records',
            details: error.message,
            code: error.code
        }, {
            status: 500
        });
    } finally{
        if (connection) connection.release();
    }
}
}}),

};

//# sourceMappingURL=%5Broot-of-the-server%5D__00eaa961._.js.map